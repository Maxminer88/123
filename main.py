import os
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from dotenv import load_dotenv
import math
import random

load_dotenv()
TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã)
user_states = {}

# –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_scores = {}

# –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
quiz_questions = [
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –í–í–ü?",
        "options": ["–ê) –í–∞–ª–æ–≤–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç", "–ë) –í–∞–ª–æ–≤–æ–π –≤–Ω–µ—à–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç", "–í) –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–∞–ª–æ–≤–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–ª–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã?",
        "options": ["–ê) –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—É—Ä—Å", "–ë) –°–≤–æ–±–æ–¥–Ω–æ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞", "–í) –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—É—Ä—Å–∞"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–æ–π –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —è–≤–ª—è–µ—Ç—Å—è –æ–ø–µ—Ä–µ–∂–∞—é—â–∏–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º?",
        "options": ["–ê) –£—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã", "–ë) –ò–Ω–¥–µ–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏", "–í) –ò–Ω—Ñ–ª—è—Ü–∏—è"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –≤–∞–ª—é—Ç–Ω—ã–π –∫—É—Ä—Å?",
        "options": ["–ê) –¶–µ–Ω–∞ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –¥—Ä—É–≥–æ–π", "–ë) –£—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏ –≤ —Å—Ç—Ä–∞–Ω–µ", "–í) –†–µ–π—Ç–∏–Ω–≥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–Ω—Å—Ç–∏—Ç—É—Ç–æ–≤"],
        "answer": "–ê"
    },
    {
        "question": "–ö–∞–∫–æ–µ –≤–ª–∏—è–Ω–∏–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–∏?",
        "options": ["–ê) –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–ë) –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∏–Ω—Ñ–ª—è—Ü–∏—é", "–í) –°–Ω–∏–∂–∞–µ—Ç —Å–ø—Ä–æ—Å –Ω–∞ –∫—Ä–µ–¥–∏—Ç"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ü–∏–∫–ª?",
        "options": ["–ê) –ü–µ—Ä–∏–æ–¥—ã —Ä–æ—Å—Ç–∞ –∏ —Å–ø–∞–¥–∞ —ç–∫–æ–Ω–æ–º–∏–∫–∏", "–ë) –£—Å—Ç–æ–π—á–∏–≤–æ–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ", "–í) –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω?",
        "options": ["–ê) –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ü–µ–Ω", "–ë) –ö–æ–ª–µ–±–∞–Ω–∏–µ –≤–∞–ª—é—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞", "–í) –¢–µ–º–ø —Ä–æ—Å—Ç–∞ —ç–∫–æ–Ω–æ–º–∏–∫–∏"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—è–∑–Ω—ë–Ω–Ω–æ—Å—Ç—å?",
        "options": ["–ê) –†–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞", "–ë) –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —ç–∫–æ–ª–æ–≥–∏–∏", "–í) –í–ª–∏—è–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥—É"],
        "answer": "–í"
    },
    {
        "question": "–ö–∞–∫–æ–π —Å—Ç–∏–º—É–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π?",
        "options": ["–ê) –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤", "–ë) –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤", "–í) –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç —Å—Ç–∞–≤–∫–∏ —Ä–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è?",
        "options": ["–ê) –£—Å–ª–æ–≤–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è", "–ë) –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–Ω–µ–≥ –¥–ª—è –±–∞–Ω–∫–æ–≤", "–í) –£—Ä–æ–≤–µ–Ω—å –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–æ–µ –∏–∑ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –≤–µ—Ä–Ω–æ –¥–ª—è –º–æ–Ω–µ—Ç–∞—Ä–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏?",
        "options": ["–ê) –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–∞–ª–æ–≥–∏", "–ë) –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –¥–µ–Ω–µ–∂–Ω—É—é –º–∞—Å—Å—É", "–í) –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –≤ –†–æ—Å—Å–∏–∏?",
        "options": ["–ê) –ú–∏–Ω—Ñ–∏–Ω", "–ë) –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–∞–Ω–∫", "–í) –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–æ—Å—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏?",
        "options": ["–ê) –°–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω", "–ë) –†–æ—Å—Ç —Ü–µ–Ω", "–í) –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ—Ñ–ª—è—Ü–∏—è?",
        "options": ["–ê) –†–æ—Å—Ç —Ü–µ–Ω", "–ë) –°–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω", "–í) –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—É?",
        "options": ["–ê) –£—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã", "–ë) –ò–Ω–¥–µ–∫—Å —Ü–µ–Ω", "–í) –í–∞–ª—é—Ç–Ω—ã–π –∫—É—Ä—Å"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏—è —Ä—É–±–ª—è?",
        "options": ["–ê) –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ä—É–±–ª—è", "–ë) –û—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ä—É–±–ª—è", "–í) –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∫—É—Ä—Å–∞"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –≤ —Å—Ç—Ä–∞–Ω–µ?",
        "options": ["–ê) –í–ù–ü", "–ë) –í–í–ü", "–í) –ù–î"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–Ω?",
        "options": ["–ê) –î–∏–Ω–∞–º–∏–∫—É —Ü–µ–Ω –Ω–∞ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏", "–ë) –£—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã", "–í) –û–±—ä—ë–º —ç–∫—Å–ø–æ—Ä—Ç–∞"],
        "answer": "–ê"
    },
    {
        "question": "–ö–∞–∫–∞—è –≤–∞–ª—é—Ç–∞ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –≤ –º–∏—Ä–µ?",
        "options": ["–ê) –ï–≤—Ä–æ", "–ë) –î–æ–ª–ª–∞—Ä –°–®–ê", "–í) –ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–π —Ñ—É–Ω—Ç"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—Ü–µ—Å—Å–∏—è?",
        "options": ["–ê) –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç", "–ë) –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–¥", "–í) –°—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞"],
        "answer": "–ë"
    },
    {
        "question": "–ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –≥–ª–∞–≤–æ–π –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏?",
        "options": ["–ê) –ú–∏–Ω–∏—Å—Ç—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤", "–ë) –ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –¶–ë –†–§", "–í) –ü—Ä–µ–º—å–µ—Ä-–º–∏–Ω–∏—Å—Ç—Ä"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏—Å–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞?",
        "options": ["–ê) –ü–æ–ª–∏—Ç–∏–∫–∞ –≤ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞–ª–æ–≥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤", "–ë) –î–µ–Ω–µ–∂–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞", "–í) –¢–æ—Ä–≥–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞"],
        "answer": "–ê"
    },
    {
        "question": "–ö–∞–∫–æ–π –Ω–∞–ª–æ–≥ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º—ã–º?",
        "options": ["–ê) –ù–î–°", "–ë) –ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥", "–í) –ê–∫—Ü–∏–∑"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –î–∂–∏–Ω–∏?",
        "options": ["–ê) –£—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ–ª—è—Ü–∏–∏", "–ë) –ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –¥–æ—Ö–æ–¥–æ–≤", "–í) –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –í–í–ü –†–æ—Å—Å–∏–∏?",
        "options": ["–ê) –†–æ—Å—Å—Ç–∞—Ç", "–ë) –¶–ë –†–§", "–í) –ú–∏–Ω—ç–∫–æ–Ω–æ–º—Ä–∞–∑–≤–∏—Ç–∏—è"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ?",
        "options": ["–ê) –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π", "–ë) –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è –í–í–ü", "–í) –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—å–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–∞–ª—é—Ç—ã?",
        "options": ["–ê) –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å", "–ë) –†–µ–∞–ª—å–Ω—ã–π –∫—É—Ä—Å", "–í) –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫—É—Ä—Å"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞–≥—Ñ–ª—è—Ü–∏—è?",
        "options": ["–ê) –†–æ—Å—Ç + –∏–Ω—Ñ–ª—è—Ü–∏—è", "–ë) –°–ø–∞–¥ + –¥–µ—Ñ–ª—è—Ü–∏—è", "–í) –°—Ç–∞–≥–Ω–∞—Ü–∏—è + –∏–Ω—Ñ–ª—è—Ü–∏—è"],
        "answer": "–í"
    },
    {
        "question": "–ö–∞–∫–æ–π –≤–∏–¥ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã —Å–≤—è–∑–∞–Ω —Å –ø–æ–∏—Å–∫–æ–º –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã?",
        "options": ["–ê) –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è", "–ë) –§—Ä–∏–∫—Ü–∏–æ–Ω–Ω–∞—è", "–í) –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è"],
        "answer": "–ë"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å?",
        "options": ["–ê) –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ –¥–µ–Ω—å–≥–∏", "–ë) –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π", "–í) –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–æ—Ä–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å?",
        "options": ["–ê) –†–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —ç–∫—Å–ø–æ—Ä—Ç–æ–º –∏ –∏–º–ø–æ—Ä—Ç–æ–º", "–ë) –û–±—â–∏–π –æ–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤–ª–∏", "–í) –ö—É—Ä—Å –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã"],
        "answer": "–ê"
    },
    {
        "question": "–ö–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –±–∞–Ω–∫–∏?",
        "options": ["–ê) –†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è", "–ë) –ù–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏–µ", "–í) –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–º–∏—Å—Å–∏—è –¥–µ–Ω–µ–≥?",
        "options": ["–ê) –ò–∑—ä—è—Ç–∏–µ –¥–µ–Ω–µ–≥ –∏–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è", "–ë) –í—ã–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –¥–µ–Ω–µ–≥", "–í) –û–±–º–µ–Ω –≤–∞–ª—é—Ç"],
        "answer": "–ë"
    },
    {
        "question": "–ö–∞–∫–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∏–∑–º–µ—Ä—è–µ—Ç –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Ü–µ–Ω –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ?",
        "options": ["–ê) –ò–ü–¶ (–ò–Ω–¥–µ–∫—Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–Ω)", "–ë) –í–í–ü", "–í) –£—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã"],
        "answer": "–ê"
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏—Ü–∏—Ç –±—é–¥–∂–µ—Ç–∞?",
        "options": ["–ê) –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞–¥ –¥–æ—Ö–æ–¥–∞–º–∏", "–ë) –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –Ω–∞–¥ —Ä–∞—Å—Ö–æ–¥–∞–º–∏", "–í) –†–∞–≤–µ–Ω—Å—Ç–≤–æ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤"],
        "answer": "–ë"
    }
]

# –°–ª–æ–≤–∞—Ä—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
economics_dictionary = {
    "–í–í–ü": "–í–∞–ª–æ–≤–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç - –æ–±—â–∞—è —Ä—ã–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥, –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤ —Å—Ç—Ä–∞–Ω–µ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.",
    "–ò–Ω—Ñ–ª—è—Ü–∏—è": "–£—Å—Ç–æ–π—á–∏–≤–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ü–µ–Ω –Ω–∞ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏ –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ.",
    "–î–µ—Ñ–ª—è—Ü–∏—è": "–°–Ω–∏–∂–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ü–µ–Ω –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ñ–ª—è—Ü–∏–∏.",
    "–†–µ—Ü–µ—Å—Å–∏—è": "–ü–µ—Ä–∏–æ–¥ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–∞–¥–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∏–π—Å—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ–º –í–í–ü –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–≤—É—Ö –∏–ª–∏ –±–æ–ª–µ–µ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ –ø–æ–¥—Ä—è–¥.",
    "–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞": "–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–∞–Ω–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫—Ä–µ–¥–∏—Ç—ã –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º –±–∞–Ω–∫–∞–º.",
    "–î–µ–≤–∞–ª—å–≤–∞—Ü–∏—è": "–°–Ω–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –¥—Ä—É–≥–∏–º –≤–∞–ª—é—Ç–∞–º.",
    "–§–∏—Å–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞": "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –≤ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.",
    "–ú–æ–Ω–µ—Ç–∞—Ä–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞": "–ü–æ–ª–∏—Ç–∏–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å–æ–π –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏.",
    "–ë–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞": "–°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —á–∞—Å—Ç—å —Ç—Ä—É–¥–æ—Å–ø–æ—Å–æ–±–Ω–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É.",
    "–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å": "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ –±—ã—Å—Ç—Ä–æ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –±–µ–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏."
}

# –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
useful_links = {
    "üìà –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–∞–Ω–∫ –†–§": "https://cbr.ru - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –¶–ë –†–§ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–µ, –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç",
    "üìä –†–æ—Å—Å—Ç–∞—Ç": "https://rosstat.gov.ru - –§–µ–¥–µ—Ä–∞–ª—å–Ω–∞—è —Å–ª—É–∂–±–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",
    "üíº –ú–∏–Ω—ç–∫–æ–Ω–æ–º—Ä–∞–∑–≤–∏—Ç–∏—è": "https://economy.gov.ru - –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –†–§",
    "üåç –ú–í–§": "https://imf.org - –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –≤–∞–ª—é—Ç–Ω—ã–π —Ñ–æ–Ω–¥",
    "üì∞ –†–ë–ö –≠–∫–æ–Ω–æ–º–∏–∫–∞": "https://rbc.ru/economics - –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏",
    "üìà Investing.com": "https://ru.investing.com - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä—ã–Ω–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞",
    "üìö –≠–∫–æ–Ω–æ–º–∏–∫—Å": "https://economicus.ru - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ"
}

# –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã
economic_formulas = {
    "–¢–µ–º–ø –∏–Ω—Ñ–ª—è—Ü–∏–∏": "((–ò–ü–¶_—Ç–µ–∫—É—â–∏–π - –ò–ü–¶_–±–∞–∑–æ–≤—ã–π) / –ò–ü–¶_–±–∞–∑–æ–≤—ã–π) √ó 100%",
    "–†–µ–∞–ª—å–Ω—ã–π –í–í–ü": "–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –í–í–ü / –î–µ—Ñ–ª—è—Ç–æ—Ä –í–í–ü",
    "–£—Ä–æ–≤–µ–Ω—å –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã": "(–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∑—Ä–∞–±–æ—Ç–Ω—ã—Ö / –†–∞–±–æ—á–∞—è —Å–∏–ª–∞) √ó 100%",
    "–†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞": "–ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ - –¢–µ–º–ø –∏–Ω—Ñ–ª—è—Ü–∏–∏",
    "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤": "1 / (1 - –ü—Ä–µ–¥–µ–ª—å–Ω–∞—è —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é)",
    "–≠–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Å–ø—Ä–æ—Å–∞": "% –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ / % –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã",
    "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä—É–¥–∞": "–í—ã–ø—É—Å–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ / –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤"
}

# –¢–µ–º—ã –¥–ª—è –¥–æ–∫–ª–∞–¥–æ–≤
presentation_topics = [
    "üè¶ –†–æ–ª—å –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ –†–æ—Å—Å–∏–∏",
    "üí± –í–ª–∏—è–Ω–∏–µ –∫—É—Ä—Å–∞ —Ä—É–±–ª—è –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫—É—é —ç–∫–æ–Ω–æ–º–∏–∫—É",
    "üìà –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ –í–í–ü –†–æ—Å—Å–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–µ—Ç",
    "üè≠ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–æ—Å—Å–∏–π—Å–∫–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–∏",
    "üåç –í–ª–∏—è–Ω–∏–µ —Å–∞–Ω–∫—Ü–∏–π –Ω–∞ —ç–∫–æ–Ω–æ–º–∏–∫—É –†–æ—Å—Å–∏–∏",
    "‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Å–µ–∫—Ç–æ—Ä –∫–∞–∫ –¥—Ä–∞–π–≤–µ—Ä —ç–∫–æ–Ω–æ–º–∏–∫–∏",
    "üåæ –†–æ–ª—å –∞–≥—Ä–∞—Ä–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞ –≤ —ç–∫–æ–Ω–æ–º–∏–∫–µ –†–æ—Å—Å–∏–∏",
    "üíº –ú–∞–ª—ã–π –∏ —Å—Ä–µ–¥–Ω–∏–π –±–∏–∑–Ω–µ—Å: –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã",
    "üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∏—Ö —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç",
    "üìä –¶–∏—Ñ—Ä–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ –≤ –†–æ—Å—Å–∏–∏: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ",
    "üèõÔ∏è –ë—é–¥–∂–µ—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ª–≥",
    "üéØ –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ –∏ —Å—Ç–∞—Ä—Ç–∞–ø-—ç–∫–æ—Å–∏—Å—Ç–µ–º–∞",
    "üåê –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞",
    "üë• –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∫–∏",
    "üè¢ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –†–æ—Å—Å–∏–∏: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
]

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–ª–∞–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def get_main_keyboard():
    keyboard = [
        [KeyboardButton("üñãÔ∏è –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è"), KeyboardButton("üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],
        [KeyboardButton("üèÜ –†–µ–π—Ç–∏–Ω–≥"), KeyboardButton("üìö –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤")],
        [KeyboardButton("üìà –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏"), KeyboardButton("üìí –ö—É—Ä—Å –ª–µ–∫—Ü–∏–π")],
        [KeyboardButton("üìΩÔ∏è –¢–µ–º—ã –¥–æ–∫–ª–∞–¥–æ–≤"), KeyboardButton("üìê –§–æ—Ä–º—É–ª—ã")],
        [KeyboardButton("üì∞ –ù–æ–≤–æ—Å—Ç–∏"), KeyboardButton("‚ùì –ü–æ–º–æ—â—å")]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

# –§—É–Ω–∫—Ü–∏—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
async def quiz_question(update: Update):
    user_id = update.effective_user.id
    question = random.choice(quiz_questions)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_states[user_id] = {
        'mode': 'quiz',
        'current_question': question
    }
    
    text = f"üß† –í–æ–ø—Ä–æ—Å:\n{question['question']}\n\n"
    for option in question['options']:
        text += f"{option}\n"
    text += f"\n–û—Ç–≤–µ—Ç—å—Ç–µ –±—É–∫–≤–æ–π (–ê, –ë –∏–ª–∏ –í)"
    await update.message.reply_text(text)

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞
async def check_quiz_answer(update: Update, user_answer: str):
    user_id = update.effective_user.id
    username = update.effective_user.first_name or "–ê–Ω–æ–Ω–∏–º"
    
    if user_id not in user_states or user_states[user_id]['mode'] != 'quiz':
        return False
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if user_id not in user_scores:
        user_scores[user_id] = {
            'name': username,
            'correct': 0,
            'incorrect': 0,
            'total': 0
        }
    
    correct_answer = user_states[user_id]['current_question']['answer']
    user_answer = user_answer.upper().strip()
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    user_scores[user_id]['total'] += 1
    
    if user_answer == correct_answer:
        user_scores[user_id]['correct'] += 1
        score = user_scores[user_id]
        percentage = round((score['correct'] / score['total']) * 100, 1)
        await update.message.reply_text(
            f"‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üéâ\n\n"
            f"üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n"
            f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score['correct']}\n"
            f"–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {score['total']}\n"
            f"–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {percentage}%",
            reply_markup=get_main_keyboard()
        )
    else:
        user_scores[user_id]['incorrect'] += 1
        score = user_scores[user_id]
        percentage = round((score['correct'] / score['total']) * 100, 1)
        await update.message.reply_text(
            f"‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {correct_answer}\n\n"
            f"üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n"
            f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score['correct']}\n"
            f"–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {score['total']}\n"
            f"–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {percentage}%",
            reply_markup=get_main_keyboard()
        )
    
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    del user_states[user_id]
    return True

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–ª–æ–≤–∞—Ä—è —Ç–µ—Ä–º–∏–Ω–æ–≤
async def show_dictionary(update: Update):
    text = "üìö –°–ª–æ–≤–∞—Ä—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤:\n\n"
    for term, definition in economics_dictionary.items():
        text += f"üîπ <b>{term}</b>\n{definition}\n\n"
    
    await update.message.reply_text(text, parse_mode='HTML', reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
async def show_useful_links(update: Update):
    text = "üìà –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ:\n\n"
    for name, link in useful_links.items():
        text += f"{name}\n{link}\n\n"
    
    await update.message.reply_text(text, reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∫—É—Ä—Å–∞ –ª–µ–∫—Ü–∏–π
async def show_course(update: Update):
    course_text = (
        "üìí –ö—É—Ä—Å –ª–µ–∫—Ü–∏–π –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ:\n\n"
        "üìñ <b>–ú–æ–¥—É–ª—å 1: –û—Å–Ω–æ–≤—ã —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π —Ç–µ–æ—Ä–∏–∏</b>\n"
        "‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç –∏ –º–µ—Ç–æ–¥—ã —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –Ω–∞—É–∫–∏\n"
        "‚Ä¢ –ë–∞–∑–æ–≤—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ–Ω—è—Ç–∏—è\n"
        "‚Ä¢ –¢–∏–ø—ã —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º\n\n"
        "üìñ <b>–ú–æ–¥—É–ª—å 2: –ú–∏–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</b>\n"
        "‚Ä¢ –°–ø—Ä–æ—Å –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ\n"
        "‚Ä¢ –≠–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å\n"
        "‚Ä¢ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è\n"
        "‚Ä¢ –¢–µ–æ—Ä–∏—è —Ñ–∏—Ä–º—ã\n\n"
        "üìñ <b>–ú–æ–¥—É–ª—å 3: –ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</b>\n"
        "‚Ä¢ –í–í–ü –∏ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç–∞\n"
        "‚Ä¢ –ò–Ω—Ñ–ª—è—Ü–∏—è –∏ –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞\n"
        "‚Ä¢ –î–µ–Ω–µ–∂–Ω–æ-–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞\n"
        "‚Ä¢ –§–∏—Å–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞\n\n"
        "üìñ <b>–ú–æ–¥—É–ª—å 4: –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞</b>\n"
        "‚Ä¢ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è\n"
        "‚Ä¢ –í–∞–ª—é—Ç–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è\n"
        "‚Ä¢ –ü–ª–∞—Ç–µ–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å\n\n"
        "üí° –î–ª—è —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª '–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏'"
    )
    await update.message.reply_text(course_text, parse_mode='HTML', reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ç–µ–º –¥–æ–∫–ª–∞–¥–æ–≤
async def show_presentation_topics(update: Update):
    text = "üìΩÔ∏è –¢–µ–º—ã –¥–ª—è –¥–æ–∫–ª–∞–¥–æ–≤ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:\n\n"
    for i, topic in enumerate(presentation_topics, 1):
        text += f"{i}. {topic}\n"
    
    text += f"\nüí° –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç, –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ!"
    await update.message.reply_text(text, reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—É–ª
async def show_formulas(update: Update):
    text = "üìê –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã:\n\n"
    for formula_name, formula in economic_formulas.items():
        text += f"üîπ <b>{formula_name}</b>\n{formula}\n\n"
    
    await update.message.reply_text(text, parse_mode='HTML', reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
async def show_news(update: Update):
    news_text = (
        "üì∞ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π:\n\n"
        "üî∏ <b>–†–æ—Å—Å–∏–π—Å–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:</b>\n"
        "‚Ä¢ –†–ë–ö –≠–∫–æ–Ω–æ–º–∏–∫–∞ - rbc.ru/economics\n"
        "‚Ä¢ –í–µ–¥–æ–º–æ—Å—Ç–∏ - vedomosti.ru\n"
        "‚Ä¢ –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä - kommersant.ru\n"
        "‚Ä¢ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ - ria.ru/economy\n\n"
        "üî∏ <b>–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:</b>\n"
        "‚Ä¢ Bloomberg - bloomberg.com\n"
        "‚Ä¢ Financial Times - ft.com\n"
        "‚Ä¢ The Economist - economist.com\n"
        "‚Ä¢ Reuters Economics - reuters.com\n\n"
        "üî∏ <b>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã:</b>\n"
        "‚Ä¢ –¶–µ–Ω—Ç—Ä —Ä–∞–∑–≤–∏—Ç–∏—è –ù–ò–£ –í–®–≠\n"
        "‚Ä¢ –ò–Ω—Å—Ç–∏—Ç—É—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–º. –ì–∞–π–¥–∞—Ä–∞\n"
        "‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ø—Ä–∏ –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–µ –†–§\n\n"
        "üìä –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ç—Ä–µ–Ω–¥–æ–≤!"
    )
    await update.message.reply_text(news_text, parse_mode='HTML', reply_markup=get_main_keyboard())

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
async def show_leaderboard(update: Update):
    if not user_scores:
        await update.message.reply_text(
            "üèÜ –†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç. –ù–∞—á–Ω–∏—Ç–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–æ–ø!",
            reply_markup=get_main_keyboard()
        )
        return
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –∑–∞—Ç–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
    sorted_users = sorted(
        user_scores.items(),
        key=lambda x: (x[1]['correct'] / max(x[1]['total'], 1), x[1]['correct']),
        reverse=True
    )
    
    text = "üèÜ –¢–æ–ø-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:\n\n"
    for i, (user_id, score) in enumerate(sorted_users[:10], 1):
        percentage = round((score['correct'] / max(score['total'], 1)) * 100, 1)
        text += f"{i}. {score['name']} - {percentage}% ({score['correct']}/{score['total']})\n"
    
    await update.message.reply_text(text, reply_markup=get_main_keyboard())

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_name = update.effective_user.first_name or "–¥—Ä—É–≥"
    welcome_text = (
        f"üëã –ü—Ä–∏–≤–µ—Ç, {user_name}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ!\n\n"
        f"üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:\n"
        f"üñãÔ∏è –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è - –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –æ—Ü–µ–Ω–∫–∞–º–∏\n"
        f"üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –≤–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n"
        f"üèÜ –†–µ–π—Ç–∏–Ω–≥ - —Ç–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã\n"
        f"üìö –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤ - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è\n"
        f"üìà –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ - –≤–∞–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã\n"
        f"üìí –ö—É—Ä—Å –ª–µ–∫—Ü–∏–π - —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n"
        f"üìΩÔ∏è –¢–µ–º—ã –¥–æ–∫–ª–∞–¥–æ–≤ - –∏–¥–µ–∏ –¥–ª—è —Ä–∞–±–æ—Ç\n"
        f"üìê –§–æ—Ä–º—É–ª—ã - —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã\n"
        f"üì∞ –ù–æ–≤–æ—Å—Ç–∏ - —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏\n\n"
        f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏!"
    )
    await update.message.reply_text(welcome_text, reply_markup=get_main_keyboard())

# –ö–æ–º–∞–Ω–¥–∞ /quiz
async def quiz_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await quiz_question(update)

# –ö–æ–º–∞–Ω–¥–∞ /stats
async def stats_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    
    if user_id not in user_scores:
        await update.message.reply_text(
            "üìä –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ù–∞—á–Ω–∏—Ç–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É!",
            reply_markup=get_main_keyboard()
        )
        return
    
    score = user_scores[user_id]
    percentage = round((score['correct'] / max(score['total'], 1)) * 100, 1)
    
    stats_text = (
        f"üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n\n"
        f"üë§ –ò–º—è: {score['name']}\n"
        f"‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score['correct']}\n"
        f"‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {score['incorrect']}\n"
        f"üìù –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {score['total']}\n"
        f"üìà –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {percentage}%\n\n"
    )
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π
    if percentage >= 90:
        stats_text += "üèÜ –£—Ä–æ–≤–µ–Ω—å: –≠–∫—Å–ø–µ—Ä—Ç –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ!"
    elif percentage >= 75:
        stats_text += "ü•á –£—Ä–æ–≤–µ–Ω—å: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"
    elif percentage >= 60:
        stats_text += "ü•à –£—Ä–æ–≤–µ–Ω—å: –•–æ—Ä–æ—à–∏–π"
    elif percentage >= 40:
        stats_text += "ü•â –£—Ä–æ–≤–µ–Ω—å: –ë–∞–∑–æ–≤—ã–π"
    else:
        stats_text += "üìö –£—Ä–æ–≤–µ–Ω—å: –ù–∞—á–∏–Ω–∞—é—â–∏–π"
    
    await update.message.reply_text(stats_text, reply_markup=get_main_keyboard())

# –ö–æ–º–∞–Ω–¥–∞ /leaderboard
async def leaderboard_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await show_leaderboard(update)

# –ö–æ–º–∞–Ω–¥–∞ /help
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = (
        "‚ùì –ü–æ–º–æ—â—å –ø–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É —Ü–µ–Ω—Ç—Ä—É:\n\n"
        "üñãÔ∏è <b>–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è</b>:\n"
        "‚Ä¢ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ\n"
        "‚Ä¢ –û—Ç–≤–µ—á–∞–π—Ç–µ –±—É–∫–≤–∞–º–∏ –ê, –ë –∏–ª–∏ –í\n"
        "‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ\n\n"
        "üìä <b>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</b>:\n"
        "‚Ä¢ –í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã\n"
        "‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤\n"
        "‚Ä¢ –£—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π\n\n"
        "üèÜ <b>–†–µ–π—Ç–∏–Ω–≥</b>:\n"
        "‚Ä¢ –¢–æ–ø-10 –ª—É—á—à–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
        "‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n\n"
        "üìö <b>–°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤</b>:\n"
        "‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ–Ω—è—Ç–∏—è\n"
        "‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è\n\n"
        "üìà <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</b>:\n"
        "‚Ä¢ –í–∞–∂–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã\n"
        "‚Ä¢ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö\n\n"
        "üìí <b>–ö—É—Ä—Å –ª–µ–∫—Ü–∏–π</b>:\n"
        "‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n"
        "‚Ä¢ –û—Ç –æ—Å–Ω–æ–≤ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ–º\n\n"
        "üìΩÔ∏è <b>–¢–µ–º—ã –¥–æ–∫–ª–∞–¥–æ–≤</b>:\n"
        "‚Ä¢ –ò–¥–µ–∏ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π\n"
        "‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã\n\n"
        "üìê <b>–§–æ—Ä–º—É–ª—ã</b>:\n"
        "‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã\n"
        "‚Ä¢ –§–æ—Ä–º—É–ª—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏\n\n"
        "üì∞ <b>–ù–æ–≤–æ—Å—Ç–∏</b>:\n"
        "‚Ä¢ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π\n"
        "‚Ä¢ –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã"
    )
    await update.message.reply_text(help_text, parse_mode='HTML', reply_markup=get_main_keyboard())

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ä–µ–∂–∏–º–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
    if await check_quiz_answer(update, text):
        return
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    if text == "üñãÔ∏è –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è":
        await quiz_question(update)
    elif text == "üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
        await stats_command(update, context)
    elif text == "üèÜ –†–µ–π—Ç–∏–Ω–≥":
        await leaderboard_command(update, context)
    elif text == "üìö –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤":
        await show_dictionary(update)
    elif text == "üìà –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏":
        await show_useful_links(update)
    elif text == "üìí –ö—É—Ä—Å –ª–µ–∫—Ü–∏–π":
        await show_course(update)
    elif text == "üìΩÔ∏è –¢–µ–º—ã –¥–æ–∫–ª–∞–¥–æ–≤":
        await show_presentation_topics(update)
    elif text == "üìê –§–æ—Ä–º—É–ª—ã":
        await show_formulas(update)
    elif text == "üì∞ –ù–æ–≤–æ—Å—Ç–∏":
        await show_news(update)
    elif text == "‚ùì –ü–æ–º–æ—â—å":
        await help_command(update, context)
    else:
        # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ
        await update.message.reply_text(
            "ü§î –ù–µ –ø–æ–Ω–∏–º–∞—é –∫–æ–º–∞–Ω–¥—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.",
            reply_markup=get_main_keyboard()
        )

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE):
    print(f"Exception while handling an update: {context.error}")

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def main():
    if not TOKEN:
        print("‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN")
        return
    
    print("ü§ñ –ó–∞–ø—É—Å–∫ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–≥–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞-–±–æ—Ç–∞...")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(TOKEN).build()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("quiz", quiz_command))
    application.add_handler(CommandHandler("stats", stats_command))
    application.add_handler(CommandHandler("leaderboard", leaderboard_command))
    application.add_handler(CommandHandler("help", help_command))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == '__main__':
    main()
